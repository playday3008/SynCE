Userspace USB driver for the Compaq iPAQ running Windows CE/PocketPC 2002.

UPDATES:

1/3/2002:	
	fixed a compilation problem for gcc < 2.96.
	this driver is not very actively maintained. there's a kernel driver
	doing the same job, as of 2.4.18 and 2.5.3, which you might want to
	try.

	added support for the hp jornada 548 and 568 thanks to info from
	heath robinson and arieh davidoff.

==============================================================================
1.	it works on redhat 7.2, kernel 2.4.7-10 with the uhci.o module. the
	default loaded is usb-uhci.o which works only about half the time.
	unload it and load uhci.o. ohci has never been reported to work yet.
	on the ipaq side, both wince 3.0 and pocketpc 2002 have been reported
	to work. models known to work are the H31xx and the H36xx.

2.	you need libusb sources. get them at http://libusb.sourceforge.net
	compile and install it. ipaqd.c uses usbi.h, which is not present
	in the libusb-devel rpm (it's internal to libusb). you need to copy
	it from their source if you're using the rpm.

3.	compile ipaqd:
	cc -o ipaqd -I/path/to/libusbheaders ipaqd.c -lusb -lutil

4.	modify /etc/hotplug/usb.agent so that it starts ipaqd (the driver),
	something like this: (I know there are better ways. the 49f/3 is
	the vendor/product id of the ipaq, so you must change it if you
	have a jornada or something else)

--- usb.agent.ORG       Wed Dec  5 15:39:00 2001
+++ usb.agent   Fri Dec  7 13:40:22 2001
@@ -281,6 +281,10 @@
     FOUND=false
     LABEL="USB product $PRODUCT"
 
+       if [ "$PRODUCT" = "49f/3/0" ]; then
+               /etc/hotplug/usb/ipaq
+               exit 0
+       fi
     # on 2.4 systems, modutils 2.4.2+ maintains MAP_CURRENT
     # ... otherwise we can't rely on it (sigh)
     case "$KERNEL" in

5.	create the script /etc/hotplug/usb/ipaq. note that you can try out an
	unsupported device by using the -p and -v options to specify the
	product and vendor id of the device.

#!/bin/bash

killall -9 ipaqd
date >/tmp/ipaqlog
echo ipaq script invoked >>/tmp/ipaqlog
[ -x /home/ganesh/work/usb/ipaqd ] && /home/ganesh/work/usb/ipaqd 2>>/tmp/ipaqlog

6.	create the script /usr/local/bin/cebox.sh - this is the ppp script.
	if you want a different location you must edit ipaqd.c
	NOTE: no chat required - ipaqd does chatting itself.

#!/bin/bash

MYIP=10.212.2.107
REMOTEIP=10.212.2.174
MYDNS=10.212.2.75

/usr/sbin/pppd nocrtscts local debug passive silent $MYIP:$REMOTEIP ms-dns $MYDNS noauth proxyarp

7.	presumably you've already installed asyncd. just connect the ipaq
	and wait for the magic tone to tell you you're connected. otherwise
	look through /tmp/ipaqlog to see what went wrong. after a few failed
	connections, it helps to soft-reset the ipaq before trying again.

8.	browse http://www.tekguru.co.uk for instructions on how to browse the
	net over usb, running windows. same trick works here as well. I had to
	make a modification - disable activesync, and manually click on your
	new connection "usbdial". enable IP forwarding on your linux box,
	start pocket internet explorer and start browsing ! note that you
	don't need asyncd enabled for this.

9.	performance is limited usually by the hci driver you're using. usb-uhci
	is better than uhci which took a nosedive sometime in 2.4.10+ and hasn't
	looked up since.

ganesh <vganesh@users.sourceforge.net>
