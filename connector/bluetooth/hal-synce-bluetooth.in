#!/usr/bin/env python

import sys
import os

sys.path.insert(0,"@SYNCEDATADIR@")
import synceconnector
from synceconnector import run_dccm, process_config, get_logger

# defaults
local_ip = "192.168.132.102"
device_ip = "192.168.132.201"

#
# main()
#
if __name__ == '__main__':

    logger = get_logger("hal-synce-bluetooth")

    if os.environ.has_key("HALD_ACTION"):
        hald_action = os.environ["HALD_ACTION"]

        if os.environ.has_key("HAL_PROP_INFO_UDI"):
            device_path = os.environ["HAL_PROP_INFO_UDI"]
        else:
            logger.critical("Hal environment not set: HAL_PROP_INFO_UDI missing")
            sys.exit(1)

    else:
        logger.critical("Hal environment not set")
        sys.exit(1)

    process_config()

    if hald_action == "addon":
        logger.debug("running as addon for bluetooth device")

        run_dccm(device_path, device_ip, local_ip, False)

        logger.error("aborting ...")
        sys.exit(1)

