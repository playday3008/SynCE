                       SYNCE + HAL MINI-HOWTO

!!! PASSWORD PROTECTED DEVICES WOULD NOT WORK YET !!!

This is a brief description of how to install/use synce-hal. Please
keep in mind that both HAL and synce-hal are still unstable and may
not necessarily work for you.



*** Installing ***
  
1. Create a user named "synce" in group "synce". You will add any user
   who wants to be able to use the Pocket PC device connected with synce-hal
   to that group.

2. Install D-BUS and HAL. If you are having trouble installing them and/or
   making them work, please consult http://www.freedesktop.org, #freedesktop
   on FreeNode or the HAL mailing-list. It is a bad idea of asking me or
   other SynCE developers about how to make HAL work.
   It is recommended that you use the latest stable version of HAL (0.4.7 at
   the moment), although later releases from the 0.5.x unstable tree should
   work. However, if using hal-0.5.x, the serial device for Pocket PC will 
   only be detected properly on cold-plug. You may use $SYNCE_SERIAL_DEVICE
   environment variable for debugging anyway.
   
3. Install the SynCE software. You will need at least the following packages:
       libsynce
       librapi2
       dccm
    If you are building them from source, build them in the order like above.
    YOU WILL NEED CVS VERSIONS OF THE SYNCE SOFTWARE!
    
4.  Create synce data directory. This is the
    directory where device connection data will be stored. The directory
    should be writable for the 'synce' user and readable for 'synce' group
    (or whatever the names you have chosen in step 1):
        # mkdir /var/run/synce
	# chown synce:synce /var/run/synce
	# chmod 750 /var/run/synce
	
5.  Install synce-hal. Please see ./configure --help for the list of available
    configure options before building the package.
        * If you have chosen user/group names other than 'synce' you will need
	  to specify --with-synce-user and --with-synce-group
	* --with-hal is the prefix of your HAL installation. Specify this
	  if you are installing synce-hal with a different prefix than your
	  HAL installation.
	* --with-dccm is the full path/command to run dccm - specify if dccm is
	  not in your $PATH
	* --with-synce-connection-dir is the directory where the connection files
	  will be stored (see step 4). Specify if it is other than
	  $PREFIX/var/run/synce
	  
6.  Restart HAL.




*** Using synce-hal ***

Connect your device via usb and HAL should call the synce-hal-callout that would
establish the connection with your Pocket PC. However, you will need some changes
to your environment when using Pocket PC with synce-hal. The problem is that SynCE
expects that you have Pocket PC connection files in your home dir under ~/.synce.
But they are not there. You will need to export SYNCE_CONNECTION_DIR variable to
point SynCE there:
  $ export SYNCE_CONNECTION_DIR="/var/run/synce"

(you can add this to your ~/.profile so that this variable is exported every time
you log in).
  
You also need to make sure that this directory is readable/executable to you and/or
any other user who needs to have access to Pocket PC. If you have followed the
instructions above, you will need to add that user(s) to the "synce" group.



*** Troubleshooting  ***

If your Pocket PC doesn't connect automatically, this is either a problem with your
synce-hal installation, HAL or a bug in software ;) First, make sure that you can
establish connection to your PDA manually:

1. Run dccm as your normal user:
     $ dccm -d 2 -f -s
  
2. In another terminal, establish serial connection to your PDA as root:

     # pppd /dev/tts/USB0 115200 connect /usr/local/bin/synce-serial-chat \
     nodefaultroute local "192.168.131.102:192.168.131.201" \
     "ms-dns" "192.168.131.102" crtscts nodetach noauth debug linkname "synce"

   This will start ppp session with the Pocket PC. Please note that your serial
   device might be something different than /dev/tts/USB0. Also, synce-serial-chat
   might be installed at a differentlocation in our system. Obviously, you will
   need to give the correct serial device and synce-serial-chat path in the
   command above.
   
If the above doesn't work, the problem is with your SynCE installation, your
kernel, your system configuration or whatever else. pppd and dccm may give you
some useful debugging messages on what is your problem.

If you are able to establish connection manually, try using synce-hal-callout:

  $ export SYNCE_CONNECTION_DIR=/var/run/synce
  $ export SYNCE_SERIAL_DEVICE=/dev/tts/USB0
  $ su -c /usr/local/libexec/hal/synce-hal-callout

synce-hal-callout should then start dccm and establish ppp connection with your
Pocket PC. You may consider rebuilding synce-hal with --enable-debugging for
verbose output.

If you are able to connect to the Pocket PC like this, then the problem is with HAL.
Make sure that your Pocket PC appears in the HAL device list when connected, and
that it has "pda" capability and "pda.pocketpc.serial" property that points to its
serial device. You may run hal like this:
  hald --verbose=yes --daemon=no
to make it stay in foreground and dump extra debugging information.




Remember, that synce-hal is unstable and may eat your children and pets if left
unattended. Anyway, if you encounter any problem, please make sure to email me
at juno106-at-users-dot-sourceforge-dot-net so that I could fix it.


cheers,
Andrei Yurkvich
