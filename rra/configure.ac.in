dnl Process this file with autoconf to produce a configure script.
AC_INIT(lib/syncmgr.h)

dnl AC_CANONICAL_HOST
dnl AC_CANONICAL_TARGET

AM_INIT_AUTOMAKE(rra, 0.1)
AM_CONFIG_HEADER(rra_config.h)

dnl Checks for programs.
AC_PROG_AWK
AC_PROG_CXX
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_LIBTOOL
AC_PROG_MAKE_SET

dnl Check for librapi2
AM_PATH_LIBSYNCE
AM_PATH_LIBRAPI2

  AC_ARG_WITH(libmimedir,
    AC_HELP_STRING(
      [--with-libmimedir[=DIR]],
      [Search for libmimedir in DIR/include and DIR/lib]),
      [
				CPPFLAGS="$CPPFLAGS -I${withval}/include"
				LDFLAGS="$LDFLAGS -L${withval}/lib"
			]
    )

  AC_ARG_WITH(libmimedir-include,
    AC_HELP_STRING(
      [--with-libmimedir-include[=DIR]],
      [Search for libmimedir header files in DIR]),
      [
				CPPFLAGS="$CPPFLAGS -I${withval}"
			]
    )

  AC_ARG_WITH(libmimedir-lib,
    AC_HELP_STRING(
      [--with-libmimedir-lib[=DIR]],
      [Search for libmimedir library files in DIR]),
      [
				LDFLAGS="$LDFLAGS -L${withval}"
			]
    )


	AC_CHECK_LIB(mimedir,mdir_parse,,[
		AC_MSG_ERROR([Can't find libmimedir (http://sourceforge.net/projects/libmimedir/)])
		])
	AC_CHECK_HEADERS(libmimedir.h,,[
		AC_MSG_ERROR([Can't find libmimedir.h (http://sourceforge.net/projects/libmimedir/)])
		])

  AC_ARG_ENABLE(recurrence,
    AC_HELP_STRING(
      [--enable-recurrence],
      [Enables recurrence experimential recurrence support]),
    AC_DEFINE(ENABLE_RECURRENCE, [1], [Define to 1 to enable recurrence support])
    )


dnl Checks for header files.

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST

AC_REPLACE_FUNCS(strndup)
AC_REPLACE_FUNCS(strcasestr)

# http://www.gnu.org/manual/autoconf-2.53/html_node/AC_LIBOBJ-vs.-LIBOBJS.html
# This is necessary so that .o files in LIBOBJS are also built via
# the ANSI2KNR-filtering rules.
LIB@&t@OBJS=`echo "$LIB@&t@OBJS" | sed 's,\.[[^.]]* ,$U&,g;s,\.[[^.]]*$,$U&,'`
LTLIBOBJS=`echo "$LIB@&t@OBJS" | sed 's,\.[[^.]]* ,.lo ,g;s,\.[[^.]]*$,.lo,'`
AC_SUBST(LTLIBOBJS)

AC_OUTPUT([Makefile
           src/Makefile
           lib/Makefile
					 man/Makefile])

